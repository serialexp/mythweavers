import{render as S,createComponent as v}from"solid-js/web";import*as i from"virtual:$histoire-generated-global-setup";import*as u from"virtual:$histoire-setup";import{defineComponent as p,h,ref as w,watch as C,onMounted as N,onUnmounted as g}from"@histoire/vendors/vue";import{HstContext as R,RenderVariant as F,RenderStory as b}from"./components.js";import{syncState as j}from"./util.js";const O=p({name:"RenderStory",props:{variant:{type:Object,required:!0},story:{type:Object,required:!0},slotName:{type:String,default:"default"}},emits:{ready:()=>!0},setup(t,{emit:l}){const d=w();let r=null,e=null,o=null;async function s(){var m,c;e=document.createElement("div"),(m=d.value)==null||m.appendChild(e);const{stop:a}=j(t.variant.state,n=>{});o=a;const f=(c=t.story.file)==null?void 0:c.component;if(!f){console.error("[histoire-plugin-solid] No component found!"),l("ready");return}if(r=S(()=>v(R.Provider,{get value(){return{story:t.story,variant:t.variant,slotName:t.slotName}},get children(){return v(f,{Hst:{Story:b,Variant:F}})}}),e),typeof(i==null?void 0:i.setupSolid)=="function"){const n=i.setupSolid;await n({story:t.story,variant:t.variant})}if(typeof(u==null?void 0:u.setupSolid)=="function"){const n=u.setupSolid;await n({story:t.story,variant:t.variant})}if(typeof t.variant.setupApp=="function"){const n=t.variant.setupApp;await n({story:t.story,variant:t.variant})}l("ready")}function y(){var a;o==null||o(),o=null,r==null||r(),r=null,e&&((a=e.parentNode)==null||a.removeChild(e),e=null)}return C(()=>t.story.id,async()=>{y(),await s()}),N(async()=>{await s()}),g(()=>{y()}),{el:d}},render(){return h("div",{ref:"el"})}});export{O as default};
